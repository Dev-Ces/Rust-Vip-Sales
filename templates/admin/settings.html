{% extends 'base.html' %}

{% block title %}Rust VIP - Ayarlar{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <h1 class="admin-title">Ayarlar</h1>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-3">
        <div class="admin-sidebar">
            <div class="admin-user-info">
                <div class="admin-avatar">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="admin-user-details">
                    <h5>{{ current_user.username }}</h5>
                    <span class="admin-badge">Yönetici</span>
                </div>
            </div>
            
            <ul class="admin-nav">
                <li>
                    <a href="{{ url_for('admin') }}">
                        <i class="fas fa-tachometer-alt"></i> Kontrol Paneli
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_orders') }}">
                        <i class="fas fa-shopping-cart"></i> Siparişler
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_payment_settings') }}">
                        <i class="fas fa-money-bill-wave"></i> Ödeme Ayarları
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('admin_users') }}">
                        <i class="fas fa-users"></i> Kullanıcılar
                    </a>
                </li>
                <li class="active">
                    <a href="{{ url_for('admin_settings') }}">
                        <i class="fas fa-cog"></i> Ayarlar
                    </a>
                </li>
                <li>
                    <a href="{{ url_for('index') }}">
                        <i class="fas fa-home"></i> Siteye Dön
                    </a>
                </li>
            </ul>
        </div>
    </div>
    
    <div class="col-md-9">
        <!-- RCON Ayarları -->
        <div class="admin-card mb-4">
            <h3>RCON Ayarları</h3>
            <form id="rconSettingsForm" method="post" action="{{ url_for('admin_settings') }}">
                <div class="form-group">
                    <label for="rconHost">RCON Sunucu Adresi</label>
                    <input type="text" class="form-control" id="rconHost" name="rcon_host" value="{{ RCON_HOST }}" required>
                </div>
                <div class="form-group">
                    <label for="rconPort">RCON Port</label>
                    <input type="number" class="form-control" id="rconPort" name="rcon_port" value="{{ RCON_PORT }}" required>
                </div>
                <div class="form-group">
                    <label for="rconPassword">RCON Şifresi</label>
                    <input type="password" class="form-control" id="rconPassword" name="rcon_password" value="{{ RCON_PASSWORD }}" required>
                </div>
                <div class="form-group">
                    <label for="vipCommand">VIP Ekleme Komutu</label>
                    <input type="text" class="form-control" id="vipCommand" name="vip_command" value="addgroup {steam_id} vip" required>
                    <small class="form-text text-muted">{steam_id} ifadesi, kullanıcının Steam ID'si ile değiştirilecektir.</small>
                </div>
                <div class="form-group">
                    <button type="button" id="testRconConnection" class="btn btn-info">
                        <i class="fas fa-plug"></i> Bağlantıyı Test Et
                    </button>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Ayarları Kaydet
                </button>
            </form>
        </div>
        
        <!-- Site Ayarları -->
        <div class="admin-card mb-4">
            <h3>Site Ayarları</h3>
            <form id="siteSettingsForm" method="post" action="{{ url_for('admin_settings') }}">
                <div class="form-group">
                    <label for="siteName">Site Adı</label>
                    <input type="text" class="form-control" id="siteName" name="site_name" value="Rust VIP" required>
                </div>
                <div class="form-group">
                    <label for="siteDescription">Site Açıklaması</label>
                    <textarea class="form-control" id="siteDescription" name="site_description" rows="3">Rust VIP Satış Sistemi</textarea>
                </div>
                <div class="form-group">
                    <label for="contactEmail">İletişim E-postası</label>
                    <input type="email" class="form-control" id="contactEmail" name="contact_email" value="contact@rustvip.com">
                </div>
                <div class="form-group">
                    <label for="vipPrice">VIP Fiyatı (USD)</label>
                    <input type="number" class="form-control" id="vipPrice" name="vip_price" value="10.00" step="0.01" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Ayarları Kaydet
                </button>
            </form>
        </div>
        
        <!-- Bakım Modu -->
        <div class="admin-card">
            <h3>Bakım Modu</h3>
            <div class="form-group">
                <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="maintenanceMode">
                    <label class="custom-control-label" for="maintenanceMode">Bakım Modunu Etkinleştir</label>
                </div>
                <small class="form-text text-muted">Bakım modu etkinleştirildiğinde, yöneticiler dışındaki kullanıcılar siteye erişemez.</small>
            </div>
            <div class="form-group">
                <label for="maintenanceMessage">Bakım Mesajı</label>
                <textarea class="form-control" id="maintenanceMessage" rows="3">Sitemiz şu anda bakımdadır. Lütfen daha sonra tekrar deneyin.</textarea>
            </div>
            <button id="saveMaintenanceSettings" class="btn btn-warning">
                <i class="fas fa-save"></i> Bakım Ayarlarını Kaydet
            </button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // RCON bağlantısını test etme
        document.getElementById('testRconConnection').addEventListener('click', function() {
            const host = document.getElementById('rconHost').value;
            const port = document.getElementById('rconPort').value;
            const password = document.getElementById('rconPassword').value;
            
            if (!host || !port || !password) {
                alert('Lütfen tüm RCON bilgilerini doldurun.');
                return;
            }
            
            // RCON bağlantısını test etmek için API isteği
            fetch('/api/rcon/status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('RCON bağlantısı başarılı!');
                    } else {
                        alert('RCON bağlantısı başarısız: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('RCON bağlantısı test edilemedi:', error);
                    alert('RCON bağlantısı test edilemedi: ' + error);
                });
        });
        
        // Bakım modu ayarlarını kaydetme
        document.getElementById('saveMaintenanceSettings').addEventListener('click', function() {
            const isEnabled = document.getElementById('maintenanceMode').checked;
            const message = document.getElementById('maintenanceMessage').value;
            
            // Burada AJAX ile bakım modu ayarları kaydedilebilir
            alert('Bakım modu ayarları kaydedildi. Etkin: ' + isEnabled);
        });
    });
</script>
{% endblock %}